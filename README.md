# NARAKA

自动完成网易大神小程序集卡活动的每日任务、抽奖、卡片互赠等操作。

## ✨ 功能特性

- ✅ **自动完成每日任务** - 自动执行并领取任务奖励
- ✅ **自动抽奖** - 消耗所有抽奖机会
- ✅ **自动分享** - 分享卡片获取额外机会
- ✅ **多账号支持** - 支持配置多个账号
- ✅ **账号互赠卡片** - 自动配对赠送/领取卡片，优先补齐缺少的卡
- ✅ **青龙面板兼容** - 完美支持青龙面板定时任务

## 📋 前置要求

1. **签名服务** - 需要可用的签名接口地址
2. **抓包工具** - Proxyman / Charles / Fiddler 等
3. **Python 3.7+** - 运行环境
4. **requests 库** - `pip install requests`


## 🔧 环境变量配置

| 变量名 | 必填 | 说明 | 示例 |
|--------|------|------|------|
| `NARAKA_SIGN_API_URL` | ✅ | 签名服务地址 | `https://game.llol.xyz/api/sign` |
| `NARAKA_TOKEN` | ✅ | 账号信息 | `TOKEN#UID#DEVICE_ID#名称` |
| `NARAKA_EXCHANGE_CARDS` | ❌ | 是否开启互赠卡片 | `True` 或 `False`，默认 `True` |

## 📱 抓包获取账号信息

### 步骤

1. 手机/电脑安装抓包工具并配置代理
2. 打开微信，进入 **"网易大神"小程序**
3. 进入 **集卡活动页面**
4. 在抓包工具中找到 `inf-miniapp.ds.163.com` 的请求
5. 从 **请求头 (Request Headers)** 中提取以下信息：

| 请求头字段 | 对应变量 |
|-----------|---------|
| `GL-Token` | TOKEN |
| `GL-Uid` | UID |
| `GL-DeviceId` | DEVICE_ID |


> ⚠️ **注意**: 卡册ID已由脚本自动处理，无需手动配置。

## 📝 账号配置格式

### 单账号
```
NARAKA_TOKEN=TOKEN#UID#DEVICE_ID
```

### 单账号带名称
```
NARAKA_TOKEN=TOKEN#UID#DEVICE_ID#我的账号
```

### 多账号（使用 `&` 分隔）
```
NARAKA_TOKEN=TOKEN1#UID1#DEVICE_ID1#账号1&TOKEN2#UID2#DEVICE_ID2#账号2
```

> 💡 **提示**:
> - 名称是可选的，不填会自动使用游戏角色名显示
> - 青龙面板可以添加多条同名 `NARAKA_TOKEN`

## 🐉 青龙面板配置

### 1. 添加脚本

将 `luck_draw_api.py` 上传到青龙面板的脚本目录。

### 2. 添加环境变量

在青龙面板 -> 环境变量 中添加：

```
NARAKA_SIGN_API_URL = https://game.llol.xyz/api/sign
NARAKA_TOKEN = TOKEN#UID#DEVICE_ID#名称
```

### 3. 添加定时任务

```
# 每天早上8点执行
0 8 * * * task luck_draw_api.py
```

### 4. 添加依赖

在青龙面板 -> 依赖管理 -> Python3 中添加：
```
requests
```


## ☁️ 关于签名服务

签名服务可以用脚本作者的，或者自行部署签名只要返回格式正确都可以使用本脚本

### 签名接口响应格式（自建/替换实现只需保持一致）

脚本只依赖接口返回字段；只要你的接口返回与下方一致，即可直接使用。

- 成功：`{"ok": true, "nonce": "...", "checksum": "..."}`
- 失败：`{"ok": false, "error": "..."}`

## 🎯 运行效果示例

```
[青龙面板] 从环境变量 NARAKA_TOKEN 读取到 2 个账号
[签名API] https://xxx.workers.dev/api/sign
[活动配置] 已自动发现 cardBookId: 69525b1fcf04676572d1af7f

============================================================
[Naraka] 开始执行每日任务
============================================================
角色: Naraka | 等级: Lv.459 | 服务器: 国服
动态参数: appKey=d90, roleId=36a0000xxxxxx..., actId=6950caxxxxxx...

[Naraka] --- 任务列表 ---
任务: 每日登录 | 状态: 已完成 | 奖励: 已领取
任务: 分享活动 | 状态: 已完成 | 奖励: 未领取
  -> 奖励领取: 成功
任务: 赠送好友卡片 | 状态: 未开始 | 奖励: 未领取
  -> 任务执行: 成功

[Naraka] --- 开始抽奖 ---
恭喜！抽到: 冰狐桃
恭喜！抽到: 一波流
没有剩余抽奖机会。

[Naraka] --- 卡片状态 ---
已拥有: 豆浆烩面(1), 一波流(5), 冰狐桃(2), 黑猫警长(1)
缺少: 穿云赛季, 混沌神狱, 神骏宝炉

############################################################
# 开始配对互相赠送卡片
############################################################

[配对赠送] Naraka <-> 账号2
[Naraka] -> [账号2] 赠送缺少的卡: 一波流
  赠送发起成功, wishId: 6952xxxxxx...
  [账号2] 领取成功!

============================================================
所有账号处理完成！
============================================================
```

## ❓ 常见问题

### Q: 报错 "请升级版本体验最新功能"
**A**: Token 可能已过期，请重新抓包获取最新的 Token。

### Q: 报错 "签名获取失败"
**A**: 检查 `NARAKA_SIGN_API_URL` 是否正确配置，确保以 `/api/sign` 结尾。

### Q: 报错 "未在当前活动中找到任务模块"
**A**: 可能活动已结束或接口返回异常，建议重新抓包更新 Token 后再试。

### Q: 多账号怎么互赠卡片？
**A**: 脚本会自动将账号两两配对（1-2、3-4、5-6...），互相赠送对方缺少的卡片。

### Q: 如何关闭互赠功能？
**A**: 设置环境变量 `NARAKA_EXCHANGE_CARDS=False`。

### Q: Token 多久过期？
**A**: 通常几天到一周不等，建议定期检查并更新。

## 📄 文件说明

| 文件 | 说明 |
|------|------|
| `luck_draw_api.py` | 主脚本 |

## ⚠️ 免责声明

- 本脚本仅供学习交流使用
- 请勿用于商业用途或大规模滥用
- 使用本脚本产生的任何后果由用户自行承担
- 如有侵权请联系删除
